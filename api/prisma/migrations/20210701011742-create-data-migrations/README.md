# Migration `20210701011742-create-data-migrations`

This migration has been generated by Tien at 7/1/2021, 8:17:42 AM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
PRAGMA foreign_keys=OFF;

CREATE TABLE "Meta" (
"id" TEXT NOT NULL,
"key" TEXT NOT NULL,
"value" TEXT NOT NULL,
"type" TEXT NOT NULL,
"draftProfileId" TEXT ,
PRIMARY KEY ("id"),
FOREIGN KEY ("draftProfileId") REFERENCES "DraftProfile"("id") ON DELETE SET NULL ON UPDATE CASCADE
)

CREATE TABLE "DraftProfile" (
"id" TEXT NOT NULL,
"fullName" TEXT NOT NULL,
"nationalId" TEXT ,
"phoneNumber" TEXT ,
"birthday" DATETIME ,
"activated" BOOLEAN NOT NULL DEFAULT true,
"createdAt" DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
PRIMARY KEY ("id"))

CREATE TABLE "ContainerType" (
"id" TEXT NOT NULL,
"slug" TEXT NOT NULL,
"name" TEXT NOT NULL,
PRIMARY KEY ("id"))

CREATE TABLE "ContainerHost" (
"id" TEXT NOT NULL,
"name" TEXT NOT NULL,
"contact" TEXT ,
"note" TEXT ,
PRIMARY KEY ("id"))

CREATE TABLE "Container" (
"id" TEXT NOT NULL,
"slug" TEXT ,
"name" TEXT NOT NULL,
"note" TEXT ,
"capacity" INTEGER  DEFAULT 0,
"updatedAt" DATETIME NOT NULL,
"createdAt" DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
"containerTypeId" TEXT NOT NULL,
"containerHostId" TEXT ,
PRIMARY KEY ("id"),
FOREIGN KEY ("containerHostId") REFERENCES "ContainerHost"("id") ON DELETE SET NULL ON UPDATE CASCADE,

FOREIGN KEY ("containerTypeId") REFERENCES "ContainerType"("id") ON DELETE CASCADE ON UPDATE CASCADE
)

CREATE TABLE "ContainerRole" (
"id" TEXT NOT NULL,
"slug" TEXT NOT NULL,
"name" TEXT NOT NULL,
"containerId" TEXT ,
"profileId" TEXT ,
PRIMARY KEY ("id"),
FOREIGN KEY ("containerId","profileId") REFERENCES "ProfilesOnContainers"("containerId","profileId") ON DELETE SET NULL ON UPDATE CASCADE
)

CREATE TABLE "ProfilesOnContainers" (
"containerId" TEXT NOT NULL,
"profileId" TEXT NOT NULL,
"note" TEXT ,
"createdAt" DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
PRIMARY KEY ("containerId","profileId"),
FOREIGN KEY ("containerId") REFERENCES "Container"("id") ON DELETE CASCADE ON UPDATE CASCADE,

FOREIGN KEY ("profileId") REFERENCES "DraftProfile"("id") ON DELETE CASCADE ON UPDATE CASCADE
)

CREATE TABLE "RW_DataMigration" (
"version" TEXT NOT NULL,
"name" TEXT NOT NULL,
"startedAt" DATETIME NOT NULL,
"finishedAt" DATETIME NOT NULL,
PRIMARY KEY ("version"))

CREATE UNIQUE INDEX "ContainerType.slug_unique" ON "ContainerType"("slug")

CREATE UNIQUE INDEX "ContainerRole.slug_unique" ON "ContainerRole"("slug")

PRAGMA foreign_key_check;

PRAGMA foreign_keys=ON;
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200925035614-migration..20210701011742-create-data-migrations
--- datamodel.dml
+++ datamodel.dml
@@ -1,25 +1,25 @@
 datasource DS {
-  provider = "mysql"
-  url = "***"
+  provider = "sqlite"
+  url = "***"
 }
 generator client {
   provider      = "prisma-client-js"
   binaryTargets = env("BINARY_TARGET")
 }
 model Meta {
-  id             String        @default(cuid()) @id
+  id             String        @id @default(cuid())
   key            String
   value          String
   type           String
   DraftProfile   DraftProfile? @relation(fields: [draftProfileId], references: [id])
   draftProfileId String?
 }
 model DraftProfile {
-  id          String                 @default(cuid()) @id
+  id          String                 @id @default(cuid())
   fullName    String
   nationalId  String?
   phoneNumber String?
   birthday    DateTime?
@@ -29,24 +29,24 @@
   containers  ProfilesOnContainers[]
 }
 model ContainerType {
-  id         String      @default(cuid()) @id
+  id         String      @id @default(cuid())
   slug       String      @unique
   name       String
   containers Container[]
 }
 model ContainerHost {
-  id         String      @default(cuid()) @id
+  id         String      @id @default(cuid())
   name       String
   contact    String?
   note       String?
   containers Container[]
 }
 model Container {
-  id              String                 @default(cuid()) @id
+  id              String                 @id @default(cuid())
   slug            String?
   name            String
   note            String?
   profiles        ProfilesOnContainers[]
@@ -59,9 +59,9 @@
   containerHostId String?
 }
 model ContainerRole {
-  id          String                @default(cuid()) @id
+  id          String                @id @default(cuid())
   slug        String                @unique
   name        String
   container   ProfilesOnContainers? @relation(fields: [containerId, profileId], references: [containerId, profileId])
   containerId String?
@@ -75,6 +75,14 @@
   profileId   String
   role        ContainerRole[]
   note        String?
   createdAt   DateTime        @default(now())
+
   @@id([containerId, profileId])
 }
+
+model RW_DataMigration {
+  version    String   @id
+  name       String
+  startedAt  DateTime
+  finishedAt DateTime
+}
```


