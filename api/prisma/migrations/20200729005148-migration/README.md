# Migration `20200729005148-migration`

This migration has been generated by nampdn at 7/29/2020, 12:51:48 AM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE `ekklisia_dev`.`User` (
`email` varchar(191) NOT NULL  ,`id` varchar(191) NOT NULL  ,`name` varchar(191)   ,`password` varchar(191) NOT NULL  ,`permission` int NOT NULL  ,`profileId` varchar(191) NOT NULL ,
    PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `ekklisia_dev`.`Profile` (
`birthday` datetime(3)   ,`createdAt` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ,`dayOfBirth` int   ,`email` varchar(191)   ,`facebookId` varchar(191)   ,`fullName` varchar(191) NOT NULL  ,`gender` varchar(191)   ,`id` varchar(191) NOT NULL  ,`joinDate` datetime(3)   ,`monthOfBirth` int   ,`oldId` varchar(191)   ,`orgId` varchar(191)  ,`phoneNumber` varchar(191)   ,`slug` varchar(191)   ,`updatedAt` datetime(3) NOT NULL  ,`yearOfBirth` int   ,
    PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `ekklisia_dev`.`Group` (
`createdAt` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ,`endAt` datetime(3)   ,`id` varchar(191) NOT NULL  ,`leaderId` varchar(191)  ,`name` varchar(191) NOT NULL  ,`orgId` varchar(191)  ,`slug` varchar(191)   ,`stage` varchar(191)   ,`startAt` datetime(3)   ,`updatedAt` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ,`year` int   ,
    PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `ekklisia_dev`.`GroupEnrollment` (
`createdAt` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ,`groupId` varchar(191) NOT NULL ,`profileId` varchar(191) NOT NULL ,`updatedAt` datetime(3) NOT NULL  ,
    PRIMARY KEY (`groupId`,`profileId`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `ekklisia_dev`.`Org` (
`id` varchar(191) NOT NULL  ,`name` varchar(191) NOT NULL  ,
    PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `ekklisia_dev`.`Activity` (
`color` varchar(191)   ,`id` varchar(191) NOT NULL  ,`name` varchar(191) NOT NULL  ,`orgId` varchar(191) NOT NULL ,`slug` varchar(191) NOT NULL  ,
    PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `ekklisia_dev`.`Schedule` (
`activityId` varchar(191) NOT NULL ,`date` datetime(3) NOT NULL  ,`id` varchar(191) NOT NULL  ,
    PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `ekklisia_dev`.`Attendance` (
`createdAt` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ,`groupId` varchar(191) NOT NULL ,`id` varchar(191) NOT NULL  ,`scheduleId` varchar(191) NOT NULL ,`slug` varchar(191) NOT NULL  ,`status` varchar(191) NOT NULL  ,`updatedAt` datetime(3) NOT NULL  ,
    PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `ekklisia_dev`.`ReportQuestion` (
`content` varchar(191) NOT NULL  ,`id` varchar(191) NOT NULL ,`type` varchar(191) NOT NULL  ,
    PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `ekklisia_dev`.`ReportCampaign` (
`date` datetime(3) NOT NULL  ,`id` varchar(191) NOT NULL ,
    PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `ekklisia_dev`.`ReportInGroup` (
`id` varchar(191) NOT NULL ,
    PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `ekklisia_dev`.`_GroupMembers` (
`A` varchar(191) NOT NULL ,`B` varchar(191) NOT NULL 
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `ekklisia_dev`.`_AttendanceAttendee` (
`A` varchar(191) NOT NULL ,`B` varchar(191) NOT NULL 
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `ekklisia_dev`.`_AttendanceAbsentee` (
`A` varchar(191) NOT NULL ,`B` varchar(191) NOT NULL 
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE UNIQUE INDEX `User.email` ON `ekklisia_dev`.`User`(`email`)

CREATE UNIQUE INDEX `Profile.oldId` ON `ekklisia_dev`.`Profile`(`oldId`)

CREATE UNIQUE INDEX `Profile.slug` ON `ekklisia_dev`.`Profile`(`slug`)

CREATE UNIQUE INDEX `Group.slug` ON `ekklisia_dev`.`Group`(`slug`)

CREATE UNIQUE INDEX `Activity.slug` ON `ekklisia_dev`.`Activity`(`slug`)

CREATE UNIQUE INDEX `Attendance.slug` ON `ekklisia_dev`.`Attendance`(`slug`)

CREATE UNIQUE INDEX `ReportCampaign_id` ON `ekklisia_dev`.`ReportCampaign`(`id`)

CREATE UNIQUE INDEX `_GroupMembers_AB_unique` ON `ekklisia_dev`.`_GroupMembers`(`A`,`B`)

CREATE  INDEX `_GroupMembers_B_index` ON `ekklisia_dev`.`_GroupMembers`(`B`)

CREATE UNIQUE INDEX `_AttendanceAttendee_AB_unique` ON `ekklisia_dev`.`_AttendanceAttendee`(`A`,`B`)

CREATE  INDEX `_AttendanceAttendee_B_index` ON `ekklisia_dev`.`_AttendanceAttendee`(`B`)

CREATE UNIQUE INDEX `_AttendanceAbsentee_AB_unique` ON `ekklisia_dev`.`_AttendanceAbsentee`(`A`,`B`)

CREATE  INDEX `_AttendanceAbsentee_B_index` ON `ekklisia_dev`.`_AttendanceAbsentee`(`B`)

ALTER TABLE `ekklisia_dev`.`User` ADD FOREIGN KEY (`profileId`) REFERENCES `ekklisia_dev`.`Profile`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `ekklisia_dev`.`Profile` ADD FOREIGN KEY (`orgId`) REFERENCES `ekklisia_dev`.`Org`(`id`) ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE `ekklisia_dev`.`Group` ADD FOREIGN KEY (`leaderId`) REFERENCES `ekklisia_dev`.`Profile`(`id`) ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE `ekklisia_dev`.`Group` ADD FOREIGN KEY (`orgId`) REFERENCES `ekklisia_dev`.`Org`(`id`) ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE `ekklisia_dev`.`GroupEnrollment` ADD FOREIGN KEY (`groupId`) REFERENCES `ekklisia_dev`.`Group`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `ekklisia_dev`.`GroupEnrollment` ADD FOREIGN KEY (`profileId`) REFERENCES `ekklisia_dev`.`Profile`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `ekklisia_dev`.`Activity` ADD FOREIGN KEY (`orgId`) REFERENCES `ekklisia_dev`.`Org`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `ekklisia_dev`.`Schedule` ADD FOREIGN KEY (`activityId`) REFERENCES `ekklisia_dev`.`Activity`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `ekklisia_dev`.`Attendance` ADD FOREIGN KEY (`groupId`) REFERENCES `ekklisia_dev`.`Group`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `ekklisia_dev`.`Attendance` ADD FOREIGN KEY (`scheduleId`) REFERENCES `ekklisia_dev`.`Schedule`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `ekklisia_dev`.`ReportQuestion` ADD FOREIGN KEY (`id`) REFERENCES `ekklisia_dev`.`ReportCampaign`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `ekklisia_dev`.`ReportCampaign` ADD FOREIGN KEY (`id`) REFERENCES `ekklisia_dev`.`ReportInGroup`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `ekklisia_dev`.`ReportInGroup` ADD FOREIGN KEY (`id`) REFERENCES `ekklisia_dev`.`Group`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `ekklisia_dev`.`_GroupMembers` ADD FOREIGN KEY (`A`) REFERENCES `ekklisia_dev`.`Group`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `ekklisia_dev`.`_GroupMembers` ADD FOREIGN KEY (`B`) REFERENCES `ekklisia_dev`.`Profile`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `ekklisia_dev`.`_AttendanceAttendee` ADD FOREIGN KEY (`A`) REFERENCES `ekklisia_dev`.`Attendance`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `ekklisia_dev`.`_AttendanceAttendee` ADD FOREIGN KEY (`B`) REFERENCES `ekklisia_dev`.`Profile`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `ekklisia_dev`.`_AttendanceAbsentee` ADD FOREIGN KEY (`A`) REFERENCES `ekklisia_dev`.`Attendance`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `ekklisia_dev`.`_AttendanceAbsentee` ADD FOREIGN KEY (`B`) REFERENCES `ekklisia_dev`.`Profile`(`id`) ON DELETE CASCADE ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration ..20200729005148-migration
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,136 @@
+datasource DS {
+  provider = "mysql"
+  url = "***"
+}
+
+generator client {
+  provider      = "prisma-client-js"
+  binaryTargets = env("BINARY_TARGET")
+}
+
+model User {
+  id         String  @default(cuid()) @id
+  email      String  @unique
+  password   String
+  permission Int
+  name       String?
+  profile    Profile @relation("UserProfile", fields: [profileId], references: [id])
+  profileId  String
+}
+
+model Profile {
+  id           String            @default(cuid()) @id
+  fullName     String
+  gender       String?
+  oldId        String?           @unique
+  slug         String?           @unique
+  email        String?
+  facebookId   String?
+  phoneNumber  String?
+  birthday     DateTime?
+  joinDate     DateTime?
+  dayOfBirth   Int?
+  monthOfBirth Int?
+  yearOfBirth  Int?
+  org          Org?              @relation("ProfileOrg", fields: [orgId], references: [id])
+  createdAt    DateTime          @default(now())
+  updatedAt    DateTime          @updatedAt
+  leader       Group[]           @relation("GroupLeader")
+  member       Group[]           @relation("GroupMembers", references: [id])
+  attendee     Attendance[]      @relation("AttendanceAttendee", references: [id])
+  absentee     Attendance[]      @relation("AttendanceAbsentee", references: [id])
+  orgId        String?
+  user         User[]            @relation("UserProfile")
+  enrollment   GroupEnrollment[]
+}
+
+model Group {
+  id            String            @default(cuid()) @id
+  name          String
+  slug          String?           @unique
+  year          Int?
+  stage         String?
+  members       Profile[]         @relation("GroupMembers", references: [id])
+  startAt       DateTime?
+  endAt         DateTime?
+  createdAt     DateTime          @default(now())
+  updatedAt     DateTime          @updatedAt @default(now())
+  leader        Profile?          @relation("GroupLeader", fields: [leaderId], references: [id])
+  leaderId      String?
+  org           Org?              @relation(fields: [orgId], references: [id])
+  orgId         String?
+  attendances   Attendance[]      @relation("AttendanceGroup")
+  enrollment    GroupEnrollment[]
+  ReportInGroup ReportInGroup[]   @relation("ReportGroup")
+}
+
+model GroupEnrollment {
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+  group     Group    @relation(fields: [groupId], references: [id])
+  profile   Profile  @relation(fields: [profileId], references: [id])
+  groupId   String
+  profileId String
+
+  @@id([groupId, profileId])
+}
+
+model Org {
+  id         String     @default(cuid()) @id
+  name       String
+  groups     Group[]
+  activities Activity[] @relation("OrgActivity")
+  Profile    Profile[]  @relation("ProfileOrg")
+}
+
+model Activity {
+  id       String     @default(cuid()) @id
+  slug     String     @unique
+  name     String
+  color    String?
+  org      Org        @relation("OrgActivity", fields: [orgId], references: [id])
+  orgId    String
+  Schedule Schedule[] @relation("ScheduleActivity")
+}
+
+model Schedule {
+  id          String       @default(cuid()) @id
+  attendances Attendance[] @relation("AttendanceSchedule")
+  date        DateTime
+  activity    Activity     @relation("ScheduleActivity", fields: [activityId], references: [id])
+  activityId  String
+}
+
+model Attendance {
+  id         String    @default(cuid()) @id
+  slug       String    @unique
+  status     String
+  createdAt  DateTime  @default(now())
+  updatedAt  DateTime  @updatedAt
+  group      Group     @relation("AttendanceGroup", fields: [groupId], references: [id])
+  schedule   Schedule  @relation("AttendanceSchedule", fields: [scheduleId], references: [id])
+  attendees  Profile[] @relation("AttendanceAttendee", references: [id])
+  absentees  Profile[] @relation("AttendanceAbsentee", references: [id])
+  groupId    String
+  scheduleId String
+}
+
+model ReportQuestion {
+  id       String         @default(cuid()) @id
+  type     String
+  content  String
+  campaign ReportCampaign @relation("ReportCampaignQuestions", fields: [id], references: [id])
+}
+
+model ReportCampaign {
+  id        String           @default(cuid()) @id
+  date      DateTime
+  questions ReportQuestion[] @relation("ReportCampaignQuestions")
+  report    ReportInGroup    @relation("ReportCampaign", fields: [id])
+}
+
+model ReportInGroup {
+  id       String         @default(cuid()) @id
+  group    Group          @relation("ReportGroup", fields: [id])
+  campaign ReportCampaign @relation("ReportCampaign")
+}
```


